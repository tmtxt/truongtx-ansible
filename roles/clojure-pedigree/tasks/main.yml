---
- name: create nginx config
  become: yes
  template: >-
    src=nginx-site
    dest=/etc/nginx/sites-available/{{ pd_site_name }}
  notify:
    - restart nginx

- name: disable default site
  become: yes
  file: >-
    path=/etc/nginx/sites-enabled/default
    state=absent
  notify:
    - restart nginx

- name: enable project site
  become: yes
  file: >-
    dest=/etc/nginx/sites-enabled/{{ pd_site_name }}
    src=/etc/nginx/sites-available/{{ pd_site_name }}
    state=link
  notify:
    - restart nginx

- name: create user for project
  become: yes
  user: name={{ pd_user }} groups=docker append=yes shell=/bin/bash

- name: clone project git repo
  become: yes
  become_user: "{{ pd_user }}"
  git: >-
    repo=https://github.com/tmtxt/clojure-pedigree.git
    dest=/home/{{ pd_user }}/website
    recursive=yes
    update=no
